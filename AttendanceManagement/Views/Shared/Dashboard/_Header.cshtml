@inject UserManager<ApplicationUser> UserManager
@inject RoleManager<IdentityRole> RoleManager

@{
    var userName = User.Identity.Name;
    var user = await UserManager.GetUserAsync(User);
    IList<string> roles;
    try
    {
        roles = await UserManager.GetRolesAsync(user);
    }
    catch
    {
        roles = new List<string>();
    }
    var name = string.Empty;
    try
    {
        name = user.FirstName.Trim() + " " + user.LastName.Trim();
    }
    catch
    {
        name = "Name Surname"; // Set a default value in case of exception
    }

}

<div id="kt_header" class="header" data-kt-sticky="true" data-kt-sticky-name="header" data-kt-sticky-offset="{default: '200px', lg: '300px'}">
    <div class="container-fluid d-flex align-items-stretch justify-content-between" id="kt_header_container">
        <div class="d-flex d-lg-none align-items-center ms-n2 me-2">
            <div class="btn btn-icon btn-active-icon-primary" id="kt_aside_toggle">
                <span class="svg-icon svg-icon-fluid">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="15" viewBox="0 0 16 15" fill="none">
                        <rect y="6" width="16" height="3" rx="1.5" fill="currentColor"/>
                        <rect opacity="0.3" y="12" width="8" height="3" rx="1.5" fill="currentColor"/>
                        <rect opacity="0.3" width="12" height="3" rx="1.5" fill="currentColor"/>
                    </svg>
                </span>
            </div>
        </div>
        <div class="d-flex align-items-stretch flex-shrink-0">
            <div class="d-flex align-items-center ms-1 ms-lg-3" id="kt_header_user_menu_toggle">
                <div class="cursor-pointer symbol symbol-30px symbol-md-40px" data-kt-menu-trigger="click" data-kt-menu-attach="parent" data-kt-menu-placement="bottom-end">
                    <img src="/assets/media/avatars/blank.png" alt="user" loading="lazy">
                </div>
                <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bold py-4 fs-6 w-275px" data-kt-menu="true">
                    <div class="menu-item px-3">
                        <div class="menu-content d-flex align-items-center px-3">
                            <div class="symbol symbol-50px me-5">
                                <img alt="Logo" src="/assets/media/avatars/blank.png" loading="lazy">
                            </div>
                            <div class="d-flex flex-column">
                                <div class="fw-bolder d-flex align-items-center fs-5">
                                    @name
                                    @if (roles.Count > 0)
                                    {
                                    <span class="badge badge-light-success fw-bolder fs-8 px-2 py-1 ms-2">@roles[0]</span>
                                    }                                </div>
                                <a href="/Users/@userName" class="fw-bold text-muted text-hover-primary fs-7">@userName</a>
                            </div>
                        </div>
                    </div>
                    <div class="separator my-2"></div>
                    <div class="menu-item px-5">
                        <a href="/Users/?email=@userName" class="menu-link px-5">
                            <span class="dropdown-link-icon me-3">
                                <partial name="Icons/_UserIcon"/>
                            </span>
                            Profile
                        </a>
                    </div>
                    <div class="menu-item px-5">
                        <a href="/" class="menu-link px-5">
                            <span class="dropdown-link-icon me-3">
                                <partial name="Icons/_DashboardIcon"/>
                            </span>
                            <span class="menu-text">Dashboard</span>
                        </a>
                    </div>
                    <div class="separator my-2"></div>
                    <div class="menu-item px-5 my-1">
                        <a href="/Settings/Basic" class="menu-link px-5">
                                                    <span class="dropdown-link-icon me-3">
                                                        <partial name="Icons/_SettingIcon"/>
                                                    </span>
                            Settings
                        </a>
                    </div>
                    <div class="menu-item px-5">
                        <a class="menu-link px-5 pointer-event" onclick="document.getElementById('logoutUser').click()">
                            <span class="dropdown-link-icon me-3">
                                <partial name="Icons/_LogoutIcon"/>
                            </span>
                            Sign Out
                        </a>
                    </div>
                    <form class="form-inline d-none" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })">
                        <button type="submit" class="nav-link btn btn-link text-dark" id="logoutUser">
                            Logout
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script defer>
    $(document).ready(function () {
        $('.menu-link').on('click', function (event) {
            if (!event.currentTarget.classList.contains("not")){
                while ($("#kt_aside").hasClass('drawer-on')){
                    $("#kt_aside_toggle").click()
                }
            }
        });
    });
</script>